<!DOCTYPE html>
<html lang="en">

<head>
    <title>Virtual Classroom</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="theme-color" content="#2196F3"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Google CSS -->
    <link rel="icon" type="image/png”" href="/icons/cardboard.png"/>
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-rc.2/css/materialize.min.css">
    <!-- Custom CSS -->
    <!--<link href="/css/main.css" rel="stylesheet">-->
    <link href="/css/course.css" rel="stylesheet">
</head>
<body>
<div>
    <%- include functions.ejs %>
    <%- include partials/header.ejs %>
    <div class="master-main">
        <div class="main">
            <div class="innerMain course">
                <% if(course){ %>
                <div class="flex-container course-title-container">
                    <div class="title left-item">
                        <p><span style="text-transform: uppercase"><%= course.code %></span> <%= course.title %></p>
                        <% if(userIsInstructor()){ %>
                        <p class="subtitle">You're the instructor of this course</p>
                        <% } else { %>
                        <p class="subtitle">You are enrolled in this course</p>
                        <% } %>
                    </div>
                    <% if(userIsInstructorOrAdmin(course)){ %>
                    <div class="right-item course-size">
                        <a id="class-size-tooltip" class="tooltipped" data-position="top" data-delay="50"
                           data-tooltip="Class Size">
                            <img src="/icons/people.svg">
                            <span><%= course.students.length %></span>
                        </a>
                    </div>
                    <% } %>
                </div>

                <ul class="lecture-list collection with-header card">
                    <li class="collection-header">
                        <p>Lectures</p>
                    </li>
                    <% if(course.lectures.length > 0){ %>
                    <% for (var j = 0; j < course.lectures.length; j++) { %>
                    <a href='/course/<%= course._id %>/<%= course.lectures[j].lectureID%>' class="collection-item flex-container">
                        <div class="left-item" style="display: inline-block">
                            <span><span style="text-transform: uppercase"><%= course.code %></span>: <%= course.lectures[j].lectureTitle %></span>
                            <% if(course.lectures[j].active){ %>
                            <span class="live-now active-blink">LIVE</span>
                            <%}%>
                        </div>
                        <div id="lectureDate" class="right-item"><%= course.lectures[j].createdOn.toDateString().slice(4, 10) %></div>
                    </a>
                    <% } %>
                    <% } else{ %>
                    <li class="collection-item">No lecture available yet.</li>
                    <% } %>
                </ul>

                <div class="card-panel course-info">
                    <span class="panel-title">Course coordinator: <%= course.instructorName %></span>
                    <p>Instructors: <% for(var i = 0; i < course.instructors.length; i++){ %>
                        <span style="padding-right:10px"><%= course.instructors[i].instructorName %></span><% } %>
                    </p><p><%= course.description %></p>
                </div>

                <% if(userIsCourseOwner()){ %>
                <div class="card">
                    <form id="course-settings-form">
                        <div class="card-content">
                            <span class="card-title-small">Course Settings</span>
                            <div class="input-field select-field">
                                <span class="label">Course instructors & Teaching Assistants</span>
                                <select id="selectCourseInstructors" name="selectCourseInstructors" multiple>
                                    <option value="" disabled selected>Choose additional course instructors
                                    </option>
                                    {{#each instructor in getAvailableInstructors}}
                                    <option value={{instructor._id}} {{userIsCourseInstructorSelect
                                            instructor._id}} {{userIsCourseOwnerSelect
                                            instructor._id}}>{{instructor.profile.first_name}}
                                        {{instructor.profile.last_name}}
                                    </option>
                                    {{/each}}
                                </select>

                            </div>
                            <span class="card-title-small">Enroll Students and Groups</span>
                            <div class="input-field file-field">
                                <span class="label">Note: The CSV file has to contain a "StudentID" and "Group" columns.</span>
                                <div class="btn">
                                    <span>File</span>
                                    <input id="student-csv" type="file" accept=".csv">
                                </div>
                                <div class="file-path-wrapper">
                                    <input class="file-path validate" type="text">
                                </div>
                            </div>
                            {{#if groups}}
                            <table class="group-table">
                                <thead>
                                <tr>
                                    <th>Group</th>
                                    <th>Members</th>
                                </tr>
                                </thead>

                                <tbody>
                                {{#each group in groups}}
                                <tr>
                                    <td>{{group.name}}</td>
                                    <td>
                                        {{#each member in group.members}}
                                        <span>{{getUserNameById member}}</span>
                                        {{/each}}
                                    </td>
                                </tr>
                                {{/each}}
                                </tbody>
                            </table>
                            {{else}}
                            <p>No default group settings were given</p>
                            {{/if}}
                        </div>
                        <div class="card-action">
                            <button class="waves-effect waves-teal btn-flat" type="button"
                                    id="cancelCourseSettings">Cancel
                            </button>
                            <button class="waves-effect waves-teal btn-flat" type="submit"
                                    id="changeCourseSettings">Change
                            </button>
                        </div>
                    </form>
                </div>
                <% if(userIsInstructorOrAdmin()){ %>
                <div id="create-lecture-modal" class="modal">
                    <form id="create-lecture-form" data-course="<%= course._id %>">
                        <div class="modal-content">
                            <h3>Create Lecture</h3>
                            <div class="input-field">
                                <input id="lectureName" name="lectureName" type="text" class="validate"
                                       autocomplete="off">
                                <label id="lectureName-label" for="lectureName">Lecture Title</label>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="waves-effect waves-teal btn-flat" id="cancel-create-lecture"
                                    type="button">Cancel
                            </button>
                            <button class="waves-effect waves-teal btn-flat" type="submit">Create</button>
                        </div>
                    </form>
                </div>
                <div class="fixed-action-btn">
                    <a id="create-lecture-trigger" class="modal-trigger btn-floating btn-large blue"
                       href="#create-lecture-modal">
                        <i class="large material-icons">add</i>
                    </a>
                </div>
                <% } %>
                <% } %>
                <% } else { %>
                <center><h3>404 Not Found :(</h3></center>
                <% } %>
                {{/if}}
                {{/with}}
                {{else}}
                {{> NotFound}}
            </div>
        </div>
    </div>
</div>
<%- include partials/footer.ejs %>
</body>
<script src="/js/course.js"></script>
</html>
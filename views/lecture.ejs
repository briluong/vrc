<!DOCTYPE html>
<html lang="en">

<head>
    <title>Virtual Classroom</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="theme-color" content="#2196F3"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Google CSS -->
    <link rel="icon" type="image/png”" href="/icons/cardboard.png"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/js/materialize.min.js"></script>
    <!-- Custom CSS -->
    <link href="/css/main.css" rel="stylesheet">
</head>

<body>
<div>
    <%- include functions.ejs %>
    <%- include partials/header.ejs %>
    <div class="main">
        <div class="innerMain lecture">
            <% if(lecture) { %>
                <div class="flex-container">
                    <div class="title">
                        <p>
                            <%= lecture.title %>
                        </p>
                    </div>
                    <div class="switch toggle-lecture-active-container">
                        <span class="live-now active-blink" data-active= <%= lecture.active %>>LIVE NOW</span>
                        <% if(userIsInstructorOrAdmin()) { %>
                            <label id="lecture-active-toggle" class="toggle-lecture-active" data-lecture="<%=lecture._id%>">OFF<input id="lecture-active-input"
                                                                                                      type="checkbox"
                                                                                                      checked="checked">
                                <span id="lecture-active-span" class="lever"></span>ON
                            </label>

                        <% } %>
                    </div>
                </div>

                <div class="card">
                    <div class="card-content">
                        <div class="card-title">
                            <% if (lecture.active) {
                                "Live"
                            } else {
                                "Offline"
                            } %>
                        </div>
                        <% if(userIsInstructorOrAdmin()) { %>
                            <div class="input-field">
                                <input id="youtubeURL" name="youtubeURL" type="text" class="validate" autocomplete="off"
                                       value=<%lecture.youtube%>>
                                <label id="youtubeURL-label" for="youtubeURL"
                                >YouTube URL</label>
                            </div>
                        <% } %>
                        <% if(lecture.active) { %>
                            <% if(lecture.youtube) { %>
                                <div class="video-container">
                                    <iframe src=<% getLectureYouTubeURL(lecture._id) %> frameborder="0" allowfullscreen></iframe>
                                </div>
                            <% } else { %>
                                <p>YouTube stream not available.</p>
                            <% } %>
                        <% } else { %>
                            <p>Lecture is not active, please check again later.</p>
                        <% } %>
                    </div>
                    <% if(lecture.active) { %>
                        <div class="card-action">
                            <a href="/course/<% lecture.courseCode %>/<% lecture.title %>/stream"
                               class="waves-effect waves-teal btn-flat">Enter Stream</a>
                        </div>
                    <% } %>
                </div>

                <% if(userIsInstructorOrAdmin()) { %>
                    <!--surround with another if block if lecture is active-->
                    <div class="card group-settings">
                    <!--card-content div-->
                        <div class="card-content">
                            <div class="card-title flex-container">
                                <p class="left-item">Group Mode</p>
                                <div class="right-item switch toggle-group-active-container">
                                    <label id="group-active-toggle" class="toggle-group-active">OFF<input id="lecture-active-input" type="checkbox" checked="checked">
                                        <span id="lecture-active-span" class="lever"></span>ON
                                    </label>
                                </div>
                                <p style="color:grey">Class size: <%numberOfEnrolledStudents()%> | Online students: <%numberOfOnlineStudents()%></p>
                                <div class="group-settings-form">
                                    <div class="group-range-field">
                                        <div class="range-field">
                                            <label class="range-field-label">Group size</label>
                                            <input <%disableGroupSizeRange()%> type="range" id="group-size-range" value=<%getGroupSize()%> min="2" max=<%numberOfEnrolledStudents()%> />
                                            <label>Note: group size cannot be changed while group mode is enabled.</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="input-field">
                                    <textarea id="displayQuestion" name="displayQuestion" class="materialize-textarea"><%lecture.displayQuestion%></textarea>
                                    <label id="displayQuestion-label" class=<%activeDisplayQuestion()%> for="displayQuestion-label">Question</label>
                                    <textarea id="displayQuestion" name="displayQuestion" class="materialize-textarea">test</textarea>
                                </div>
                            </div>
                        </div>
                        <% if(groupModeIsActive()){%>
                            <div class="card-action">
                                <button id="update-display-question" class="waves-effect waves-teal btn-flat" type="button">Update</button>
                                <button id="clear-display-question" class="waves-effect waves-teal btn-flat" type="button">Clear</button>
                            </div>
                        <% } %>
                    </div>
                <% } %>

                <% if(course.groups !== undefined && course.groups !== null){ %>
                    <% if(Object.keys(course.groups).length !== 0 && course.groups.constructor == Object){ %>
                        <ul id="groups-collapsible" class="collapsible card" data-collapsible="accordion">
                            <% let groupNames = Object.keys(course.groups) %>
                            <% for(var i = 0; i < groupNames.length; i++){ %>
                                <li>
                                    <div class="collapsible-header">
                                        <i class="material-icons">group</i>Group
                                        <%= groupNames[i] %>
                                    </div>
                                    <div class="collapsible-body">
                                    </div>
                                </li>
                            <% } %>
                        </ul>
                    <% } %>
                <% } %>

            <% } else { %>
                <h3>404 not found :(</h3>
            <% } %>

        </div>
    </div>


    <%- include partials/footer.ejs %>
</div>
</body>
<link href="/css/lecture.css" rel="stylesheet">
<script src="/js/lecture.js"></script>
</html>